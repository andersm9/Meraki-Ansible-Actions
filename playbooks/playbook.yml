---
- hosts: localhost
  ignore_errors: yes
  connection: localhost
  gather_facts: False
  vars:
    EC2_REGION: eu-west-1
    AWS_REGION: eu-west-1
    region: eu-west-1
    count: 1
    auth_key: "{{ auth }}"
    AWS_ACCESS_KEY_ID: "{{ AWS_ACCESS_KEY_ID }}"
    AWS_SECRET_ACCESS_KEY: "{{ AWS_SECRET_ACCESS_KEY }}"

  vars_files:
    - config.yaml

    - debug:
        msg: "{{ TESTSECRET }}"

  tasks:

    - name: include variables for devices
      include_vars:
        file: config.yaml
        #name: devices

    - name: GET The UPLINK IP
      uri:
        url: https://api.meraki.com/api/v1/organizations/265528/appliance/uplink/statuses
        method: GET
        headers:
          Content-Type: application/json
          Accept: application/json
          X-Cisco-Meraki-API-Key: "{{ auth }}"
        return_content: true
        follow_redirects: all
        validate_certs: true
      register: meraki_uplink

    - debug:
        msg: "{{ VPNNAME }}"

    - name: GET Appliance Subnets
      uri:
        url: https://api.meraki.com/api/v1/devices/Q2NY-UYYZ-XVLK/appliance/dhcp/subnets
        method: GET
        headers:
          Content-Type: application/json
          Accept: application/json
          X-Cisco-Meraki-API-Key: "{{ auth }}"
        return_content: true
        follow_redirects: all
        validate_certs: true
      register: meraki_subnets

# AWS part
    - name: GET AWS Network info
      ec2_vpc_net_info:
      register: vpc_ids
